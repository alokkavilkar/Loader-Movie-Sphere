pipeline{
    agent {
        label 'worker'
    }

    environment{
        MANAGER_IP = '107.23.6.108'
    }

    stages{
        

        
            stage('copy')
            {
                // steps{
                //     withCredentials([sshUserPrivateKey(credentialsId:'docker-swarm-id', keyFileVariable: 'SSH_KEY', usernameVariable: 'SSH_USER')])
                //     {
                //         script{
                //             sh "scp -o StrictHostKeyChecking=no docker-compose.yml ${SSH_USER}@${MANAGER_IP}:/home/ubuntu/deployments"
                //         }
                //     }
                // }

                steps {
                    sshagent(credentials: ['docker-swarm-id']){
                    script{
                            sh "scp -o StrictHostKeyChecking=no docker-compose.yml ubuntu@${MANAGER_IP}:/home/ubuntu/deployments"
                        }
                    }
                }

            }
        
        stage("deploy")
        {
            steps{
                withCredentials([sshUserPrivateKey(credentialsId:'docker-swarm-id', keyFileVariable: 'SSH_KEY')])
                {
                    script{
                        powershell 'echo $Env:SSH_KEY'
                    }
                }
            }
        }
    }
}